%%inherit(file="/_main.haml")
%%namespace(name='tree_utils', file='tree.haml')
%%namespace(name='blob_utils', file='blob.haml')
%%namespace(name='utils', file='_utils.haml')
-!
    import datetime
    import itertools
    import pygit2 as git
    from gitbase.utils import debug
-
    try:
        head = repo.git.head.get_object()
    except git.GitError:
        head = None


@breadcrumb
    %li
        %a(href=url_for('group', group=group))
            &= group.name
    %li
        &= repo.name



@render_title(repo, link=True)

    @_title
        - if repo.is_public:
            %span.glyphicon.glyphicon-book
        - else:
            %span.glyphicon.glyphicon-lock
        &= repo.group.name + ' / ' + repo.name

    - if link:
        %a(href=url_for('repo', repo=repo)) +_title
    - else:
        +_title


@render_card(repo, avatar_size=64, link=True)
    
    -
        try:
            head = repo.git.head.get_object()
        except git.GitError:
            head = None

    .media

        -# .pull-left
            %img.thumbnail.media-object(src=resized_img_src('/img/git-logo-pale.png', width=avatar_size, height=avatar_size), width=avatar_size, height=avatar_size)

        .media-body

            %h4.media-heading +render_title(repo, link=link)
            %p
                - if repo.description: &= repo.description
                - else: %em No description.
            %p %small
                - if head: Last updated ${fuzzy_time(head.commit_time)}.
                - else: %em No commits.

            .input-group(style='width: 50%')
                %span.input-group-addon +utils.icon('cloud-download')
                %input.form-control.input-sm(type='text', readonly=True, onclick='this.select()', value='git@%s:%s/%s' % (request.host, repo.group.name, repo.name))


+render_card(repo, link=False, avatar_size=128)


%ul.nav.nav-tabs
    %li.active %a(href='#')
        +utils.icon('folder-open')
        Files
    %li %a(href=url_for('commits', repo=repo))
        +utils.icon('list')
        Commits


- if head:
    = tree_utils.render_tree(repo, head.tree, title=head.message)
- else:
    .alert.alert-warning There are no files.


