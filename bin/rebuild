#!/usr/bin/env bash

rm var/sqlite/main.sqlite
migrate

echo Importing existing repos
git-base-import

echo Converting mikeboers to a user
git-base-account -t user -r wheel -p password mikeboers

echo Adding SSH key...
git-base-account -k "$(cat ~/.ssh/id_rsa-localgit.pub)" mikeboers

echo Adding 'westernx' group...
git-base-account --append --group westernx mikeboers

echo Adding 'swisssol' group...
git-base-account --append --group swisssol mikeboers

echo Setting base visibility...
sqlite3 var/sqlite/main.sqlite <<EOF

UPDATE accounts SET is_public = 1 WHERE name in ('mikeboers', 'westernx');
UPDATE repos SET is_public = 1;

EOF


echo Done.